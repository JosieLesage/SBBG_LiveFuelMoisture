---
title: "Simple LFM Graphs"
author: "Josie Lesage"
date: "7/16/2020"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(plotrix)
library(reactable)
library(gridExtra)
```

# Introduction

This code is meant to produce a simple graph of LFM at sites near the Santa Barbara Botanic Garden to raise awareness of fire danger and keep local residents informed of fire danger.  

Data is typically collected every two weeks from each site. Samples are collected and dried in accordance with USFS recommendations.  

In the near future, we hope to show conditions near the Garden (in Mission Canyon) and near St. Mary's. 

```{r data, include=FALSE, echo=FALSE}
LFM_raw <- read.csv("LFM_PaintedCave.csv") %>%
  mutate(LFM = LFM*100,
         Species = recode_factor(Species,
                                 "ADFA" = "Chamise \n (Adenostoma fasiculatum)",
                                 "CEME" = "Bigpod ceanothus \n (Ceanothus megacarpus)"))

LFM <- LFM_raw %>%
  filter(Concern != "Yes",
         Species != "CEBE",
         Species != "QUAG", 
         Site != "Montecito Fire",
         Site != "Tunnel Road") %>%
  group_by(Collection.date, Site, Species) %>%
  summarise(meanLFM = mean(LFM),
            seLFM = std.error(LFM)) %>%
  mutate(Site2 = Site,
         Species2 = Species) %>%
  unite(Site2, Species2, col = "ID", sep = " - ")
```

# Current conditions 
Here are the current conditions at Painted Cave. At some sites, only one sample is collected and there are no error bars. For sites with error bars, these represent the standard error.

```{r Graph of current conditions, echo=FALSE}
ggplot(LFM, aes(x = Collection.date, y = meanLFM, color = Site, group = (ID))) +
  geom_point(aes(shape = Species), size = 3) +
  geom_errorbar(aes(ymin = meanLFM-seLFM, ymax = meanLFM+seLFM, width = 0.2), size = 1) +
  geom_line(size = 1, aes(linetype = Species)) +
  labs(x = "Collection date",
       y = "Live Fuel Mositure Content (%)",
       title = "Live Fuel Moisture Conditions") +
  scale_y_continuous(limits = c(0,180), expand = c(0,0), breaks=seq (0,200,10)) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = -45, vjust = -0.5, hjust = 0.5)) +
  facet_wrap(~Species)

reactable(LFM_summary <- LFM %>%
  group_by(Collection.date, Species) %>%
  summarise(meanLFM = mean(meanLFM)) %>%
  spread(Collection.date, meanLFM) %>%
  mutate_if(is.numeric, round, digits = 2))

```

# Historical data
We'd also like to know how current conditions compare with past data, we we'll summarize average monthly LFM for the past few years, and then will compare that line to this year's data.

```{r historical comparison}
LFM_pre_2020 <- LFM_raw %>%
  filter(Concern != "Yes",
         Species != "CEBE",
         Species != "QUAG", 
         Site != "Montecito Fire",
         Site != "Tunnel Road",
         Site != "St Mary's") %>%
  separate(Collection.date, sep = "-", into = c("year", "month", "day")) %>%
  filter(year != "2020") %>%
  group_by(Site, Species, month) %>%
  summarise(meanLFM = mean(LFM),
            seLFM = std.error(LFM)) %>%
  mutate(time = "Historical (2013-2019)")

LFM_2020 <- LFM_raw %>%
  filter(Concern != "Yes",
         Species != "CEBE",
         Species != "QUAG", 
         Site != "Montecito Fire",
         Site != "Tunnel Road",
         Site != "St Mary's") %>%
  separate(Collection.date, sep = "-", into = c("year", "month", "day")) %>%
  filter(year == "2020") %>%
  group_by(Site, Species, month) %>%
  summarise(meanLFM = mean(LFM),
            seLFM = std.error(LFM)) %>%
  mutate(time = "2020")

LFM_comp <- bind_rows(LFM_pre_2020, LFM_2020)

LFM_comp_graph <- ggplot(LFM_comp, aes(x = month, y = meanLFM, color = time, group = time)) +
  geom_point(aes(shape = Species), size = 3) +
  geom_errorbar(aes(ymin = meanLFM-seLFM, ymax = meanLFM+seLFM, width = 0.2), size = 1) +
  geom_line(size = 1, aes(linetype = time, color = time)) +
  labs(x = "Collection date",
       y = "Live Fuel Mositure Content (%)",
       title = "Live Fuel Moisture Conditions at Painted Cave") +
  scale_y_continuous(limits = c(50,140), expand = c(0,0), breaks=seq (0,200,10)) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = -45, vjust = -0.5, hjust = 0.5)) +
  facet_wrap(~Species)
  
```


```{r year by year comparison}
LFM_allyears <- LFM_raw %>%
  filter(Concern != "Yes",
         Species != "CEBE",
         Species != "QUAG", 
         Site != "Montecito Fire",
         Site != "Tunnel Road",
         Site != "St Mary's") %>%
  separate(Collection.date, sep = "-", into = c("year", "month", "day")) %>%
  group_by(Site, Species, year, month) %>%
  summarise(meanLFM = mean(LFM),
            seLFM = std.error(LFM)) 

LFM_all_graph <- ggplot(LFM_allyears, aes(x = month, y = meanLFM, color = year, group = year)) +
  geom_point(aes(shape = Species), size = 3) +
  geom_errorbar(aes(ymin = meanLFM-seLFM, ymax = meanLFM+seLFM, width = 0.2), size = 1) +
  geom_line(size = 1, aes(color = year)) +
  labs(x = "Collection date",
       y = "Live Fuel Mositure Content (%)",
       title = "Live Fuel Moisture Conditions at Painted Cave") +
  scale_y_continuous(limits = c(50,160), expand = c(0,0), breaks=seq (0,200,10)) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = -45, vjust = -0.5, hjust = 0.5)) +
  facet_wrap(~Species)
  
```

```{r comparison graphs}

grid.arrange(LFM_comp_graph, LFM_all_graph)

```

